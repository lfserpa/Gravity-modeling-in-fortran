      SUBROUTINE TALW(Z1,Z2,X1,X2,Y1,A,B,EL)
C
C     THIS SUBROUTINE CALCULATES THE INTEGRAL OVER ONE
C     SIDE OF A POLYGON WITH FINITE STRIKE LENGTH
C
      COMMON/N2/ PXCF,PZCF,QCF
      COMPLEX I,F1,F2,FLN,DXIZ
      YSQ=Y1*Y1
      ZMAG1=Z1+EL
      ZMAG2=Z2+EL
      VR1=SQRT(X1**2+YSQ+ZMAG1**2)
      VR2=SQRT(X2**2+YSQ+ZMAG2**2)
      I=CMPLX(0.0,1.0)
      A=0.
      B=0.
      NCK=0
      IF(ABS(X1-X2).LT.0.001)NCK=1
      IF(ABS(X1).LT.0.00001)X1=0.00001
      IF(ABS(X2).LT.0.00001)X2=0.00001
      IF(ABS(Z1).LT.0.00001)Z1=0.00001
      IF(ABS(Z2).LT.0.00001)Z2=0.00001
      TP1=6.2831853
      DX=X2-X1
      DZ=Z2-Z1
C
C     THIS SECTION CALCULATES THE INTEGRAL FOR MAGNETIC DATA
C     SHUEY AND PASQUALE, 1973
C
      IF(DX.EQ.0.0.AND.DZ.EQ.0.0)GO TO 999
      DXIZ=DX+I*DZ
      F1=(DXIZ*(1.+VR1/Y1))/(X1+I*ZMAG1)+(I/YSQ)*(X1*DZ-ZMAG1*DX)
      F2=(DXIZ*(1.+VR2/Y1))/(X2+I*ZMAG2)+(I/YSQ)*(X2*DZ-ZMAG2*DX)
      FLN=(CLOG(F2/F1))/DXIZ
      Q2=DX*REAL(FLN)*QCF
      Q1=DZ*AIMAG(FLN)*eQCF
      PZ1=-DX*AIMAG(FLN)*PZCF
      PX1=DZ*REAL(FLN)*PXCF
      B=Q1+PZ1+PX1
C
C     THIS SECTION CALCULATES THE INTEGRAL FOR GRAVITY DATA
C     (CADY, 1977)
C
      IF (ABS(DX).LT.0.0001)DX=0.0001
      IF (ABS(DZ).LT.0.0001)DZ=0.0001
      IF(NCK.GT.0)GO TO 999
      EM=DZ/DX
      CSQ=1.+EM**2
      C=(SQRT(DZ*DZ+DX*DX))/DX
      Z0=Z1-EM*X1
      AA=Z0/C
      ASQ=AA*AA
      AK=Z0/CSQ
      X0=EM*AK
      BX=X2+X0
      IF(ABS(BX).LT.0.0001)BX=0.0001
      BI=X1+X0
      IF(ABS(BI).LT.0.0001)BI=0.0001
      CBX=C*BX
      CBI=C*BI
      JEND=1
      IF(ABS(Y1).LT.0.001)JEND=0
      RSQ1=X1**2+Z1**2
      RSQ2=X2**2+Z2**2
      RY1=SQRT(YSQ+RSQ1)
      RY11=SQRT(YSQ+RSQ2)
      T1=0.
      T2=0.
      IF(RSQ2.GT.0.)T1=BX*ALOG(RSQ2)
      IF(RSQ1.GT.0.)T2=BI*ALOG(RSQ1)
      T3=ATAN2(BX,AK)
      IF(BX.GT.0..AND.AK.LT.0.)T3=T3-TPI
      T4=ATAN2(B1,AK)
      IF(BI.GT.0..AND.AJ.GT.0.)T4=T4-TPI
      IF(JEND.EQ.0)GO TO 999
C
C     THE GOTO STATEMENT ABOVE IS TO 998 IN MY THESIS
C
      T5=B1*ALOG((Y1+RY1)**2)
      T6=BX*ALOG((Y1+RY11)**2)
      T7=Y1/C*ALOG((CBI+RY1)/(CBX+RY11))
      FNUM=ASQ+YSQ+Y1*R11
      DEN=Z0*BX
      T9=ATAN2(FNUM,DEN)
      IF(FNUM.LT.0..AND.DEN.LT.0.)T9=T9+TPI
      FNUM=ASQ+YSQ+Y1*RY1
      DEN=Z0*B1
      T11=ATAN2(FNUM,DEN)
      IF(FNUM.LT.0..AND.DEN.LT.0.)T11=T11+TPI
      A=T1-T2+2.*AK*(T3-T4)+T5-T6+T7*2.+AK*(T9*2.-T11*2.)
      GO TO 997
  996 A=T1-T2+2.*AK*(T3-T4)
  997 A=-A
      IF(ABS(Q2-Q1).LT.0.0001)GO TO 999
      Q=Q1-Q2
  999 CONTINUE
      RETURN
      END
 